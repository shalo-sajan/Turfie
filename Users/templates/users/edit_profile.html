{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Profile - Turfie</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
        .file-input-wrapper input[type=file] {
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
        }
        .tab-active {
            border-bottom-color: #16a34a; /* green-600 */
            color: #16a34a; /* green-600 */
        }
    </style>
</head>
<body class="text-gray-800">
    <div class="relative min-h-screen lg:flex">
        <!-- Sidebar -->
        <aside id="sidebar" class="bg-white border-r border-gray-100 w-72 h-full fixed top-0 left-0 z-40 transform -translate-x-full transition-transform duration-300 ease-in-out lg:translate-x-0 lg:flex flex-col">
            <!-- Conditional Sidebar Header -->
            {% if user.is_turf_owner %}
            <div class="p-6 border-b border-gray-100">
                <a href="{% url 'users:dashboard_turf_owner' %}" class="flex items-center gap-3 text-3xl font-bold text-green-600">
                    <i class="fas fa-futbol"></i>
                    <span>Turfie</span>
                </a>
            </div>
             <div class="p-4 border-b border-gray-100">
                <div class="flex items-center gap-4">
                    <img src="{% if user.profile_picture %}{{ user.profile_picture.url }}{% else %}{% static 'Users/images/default-avatar.png' %}{% endif %}" alt="User" class="w-12 h-12 rounded-full object-cover">
                    <div>
                        <h4 class="font-bold text-gray-800">{{ user.business_name|default:user.username }}</h4>
                        <p class="text-sm text-gray-500">Turf Owner</p>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="p-6 border-b border-gray-100">
                <a href="{% url 'users:dashboard_player' %}" class="flex items-center gap-3 text-3xl font-bold text-green-600">
                    <i class="fas fa-futbol"></i>
                    <span>Turfie</span>
                </a>
            </div>
            {% endif %}
            
            <!-- Conditional Nav Menu -->
            <nav class="flex-grow p-4">
                {% if user.is_turf_owner %}
                <ul class="space-y-2">
                    <li><a href="{% url 'users:dashboard_turf_owner' %}" class="group flex items-center gap-4 py-3 px-4 rounded-xl hover:bg-gray-100 transition-colors"><i class="fas fa-tachometer-alt w-5 text-center text-gray-400 group-hover:text-green-600"></i> <span>Dashboard</span></a></li>
                    <li><a href="{% url 'turfs:all_bookings' %}" class="group flex items-center gap-4 py-3 px-4 rounded-xl hover:bg-gray-100 transition-colors"><i class="fas fa-calendar-alt w-5 text-center text-gray-400 group-hover:text-green-600"></i> <span>Bookings</span></a></li>
                    <li><a href="{% url 'turfs:turf_list' %}" class="group flex items-center gap-4 py-3 px-4 rounded-xl hover:bg-gray-100 transition-colors"><i class="fas fa-map-marked-alt w-5 text-center text-gray-400 group-hover:text-green-600"></i> <span>My Turfs</span></a></li>
                    <li><a href="#" class="group flex items-center gap-4 py-3 px-4 rounded-xl hover:bg-gray-100 transition-colors"><i class="fas fa-wallet w-5 text-center text-gray-400 group-hover:text-green-600"></i> <span>Payments</span></a></li>
                    <li><a href="{% url 'users:edit_profile' %}" class="flex items-center gap-4 py-3 px-4 rounded-xl text-green-700 bg-green-100 font-semibold transition-all duration-300 transform hover:scale-105"><i class="fas fa-cog w-5 text-center"></i> <span>Settings</span></a></li>
                    <li class="pt-4 mt-4 border-t border-gray-100"><a href="{% url 'users:logout' %}" class="group flex items-center gap-4 py-3 px-4 rounded-xl hover:bg-gray-100 transition-colors"><i class="fas fa-sign-out-alt w-5 text-center text-gray-400 group-hover:text-green-600"></i> <span>Logout</span></a></li>
                </ul>
                {% else %}
                <ul class="space-y-2">
                    <li><a href="{% url 'users:dashboard_player' %}" class="group flex items-center gap-4 py-3 px-4 rounded-xl hover:bg-gray-100 transition-colors"><i class="fas fa-home w-5 text-center text-gray-400 group-hover:text-green-600"></i> <span>Dashboard</span></a></li>
                    <li><a href="{% url 'users:my_bookings' %}" class="group flex items-center gap-4 py-3 px-4 rounded-xl hover:bg-gray-100 transition-colors"><i class="fas fa-calendar-alt w-5 text-center text-gray-400 group-hover:text-green-600"></i> <span>My Bookings</span></a></li>
                    <li><a href="{% url 'turfs:turf_search' %}" class="group flex items-center gap-4 py-3 px-4 rounded-xl hover:bg-gray-100 transition-colors"><i class="fas fa-search w-5 text-center text-gray-400 group-hover:text-green-600"></i> <span>Find Turfs</span></a></li>
                    <li><a href="{% url 'users:favorites' %}" class="group flex items-center gap-4 py-3 px-4 rounded-xl hover:bg-gray-100 transition-colors"><i class="fas fa-heart w-5 text-center text-gray-400 group-hover:text-green-600"></i> <span>Favorites</span></a></li>
                    <li><a href="#" class="group flex items-center gap-4 py-3 px-4 rounded-xl hover:bg-gray-100 transition-colors"><i class="fas fa-wallet w-5 text-center text-gray-400 group-hover:text-green-600"></i> <span>Payments</span></a></li>
                    <li><a href="{% url 'users:edit_profile' %}" class="flex items-center gap-4 py-3 px-4 rounded-xl text-green-700 bg-green-100 font-semibold transition-all duration-300 transform hover:scale-105"><i class="fas fa-cog w-5 text-center"></i> <span>Settings</span></a></li>
                    <li><a href="{% url 'users:logout' %}" class="group flex items-center gap-4 py-3 px-4 rounded-xl hover:bg-gray-100 transition-colors"><i class="fas fa-sign-out-alt w-5 text-center text-gray-400 group-hover:text-green-600"></i> <span>Logout</span></a></li>
                </ul>
                {% endif %}
            </nav>
        </aside>

        <div class="flex-1 lg:ml-72">
             <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-30 border-b border-gray-100">
                 <div class="flex justify-between items-center p-4 sm:p-6 lg:p-8">
                     <div class="flex items-center gap-4">
                        <button id="menu-toggle" class="lg:hidden text-gray-600 text-2xl">
                            <i class="fas fa-bars"></i>
                        </button>
                        <h1 class="text-2xl md:text-3xl font-bold">Settings</h1>
                     </div>
                     
                    <div class="hidden sm:flex items-center gap-4">
                        <a href="{% url 'users:edit_profile' %}" class="flex items-center gap-3 p-2 pr-4 rounded-full hover:bg-gray-100 transition-all duration-300">
                            <img src="{% if user.profile_picture %}{{ user.profile_picture.url }}{% else %}{% static 'Users/images/default-avatar.png' %}{% endif %}" alt="{{ user.username }}'s avatar" class="w-9 h-9 rounded-full object-cover border-2 border-gray-200">
                            <span class="font-semibold">{{ user.username }}</span>
                        </a>
                    </div>
                 </div>
            </header>
            
            <main class="p-4 sm:p-6 lg:p-8">
                <div class="max-w-4xl mx-auto">
                    <!-- Tab Navigation -->
                    <div class="border-b border-gray-200 mb-8">
                        <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                            <button class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-semibold text-base tab-active" data-tab="profile">
                                <i class="fas fa-user-edit mr-2"></i>Edit Profile
                            </button>
                            <button class="tab-button whitespace-nowrap py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-semibold text-base" data-tab="password">
                                <i class="fas fa-lock mr-2"></i>Change Password
                            </button>
                            <button class="tab-button whitespace-nowrap py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-semibold text-base" data-tab="danger">
                                <i class="fas fa-exclamation-triangle mr-2"></i>Danger Zone
                            </button>
                        </nav>
                    </div>

                    <!-- Tab Content -->
                    <div id="tab-content">
                        <!-- Edit Profile Tab -->
                        <div class="tab-pane active" id="profile">
                             <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg shadow-gray-200/50 border border-gray-100">
                                <h2 class="text-xl font-bold text-gray-800 mb-6">Personal Information</h2>
                                <form method="POST" enctype="multipart/form-data">
                                    {% csrf_token %}
                                    <div class="flex items-center gap-6 mb-8">
                                        <img id="avatar-preview" src="{% if user.profile_picture %}{{ user.profile_picture.url }}{% else %}{% static 'Users/images/default-avatar.png' %}{% endif %}" alt="Current profile picture" class="w-24 h-24 rounded-full object-cover border-4 border-gray-200">
                                        <div class="file-input-wrapper">
                                            <button type="button" class="py-2.5 px-5 rounded-lg font-semibold bg-green-600 text-white hover:bg-green-700 transition-colors">Change Picture</button>
                                            {{ form.profile_picture }}
                                        </div>
                                    </div>

                                    <!-- CONDITIONAL FORM FIELDS START -->
                                    {% if user.is_turf_owner %}
                                    <!-- Fields for Turf Owner -->
                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                        <div class="sm:col-span-2">
                                            <label for="{{ form.business_name.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">Business Name</label>
                                            {{ form.business_name }}
                                        </div>
                                        <div>
                                            <label for="{{ form.first_name.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">Contact First Name</label>
                                            {{ form.first_name }}
                                        </div>
                                        <div>
                                            <label for="{{ form.last_name.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">Contact Last Name</label>
                                            {{ form.last_name }}
                                        </div>
                                        <div class="sm:col-span-2">
                                            <label for="{{ form.email.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">Email Address</label>
                                            {{ form.email }}
                                        </div>
                                    </div>
                                    {% else %}
                                    <!-- Fields for Player -->
                                     <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                        <div>
                                            <label for="{{ form.first_name.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">First Name</label>
                                            {{ form.first_name }}
                                        </div>
                                        <div>
                                            <label for="{{ form.last_name.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">Last Name</label>
                                            {{ form.last_name }}
                                        </div>
                                        <div class="sm:col-span-2">
                                            <label for="{{ form.email.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">Email Address</label>
                                            {{ form.email }}
                                        </div>
                                         <div class="sm:col-span-2">
                                            <label for="{{ form.username.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">Username</label>
                                            {{ form.username }}
                                        </div>
                                        <div class="sm:col-span-2">
                                            <label for="{{ form.bio.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">Bio</label>
                                            {{ form.bio }}
                                        </div>
                                    </div>
                                    {% endif %}
                                    <!-- CONDITIONAL FORM FIELDS END -->
                                    
                                    <div class="mt-8">
                                        <button type="submit" name="update_profile" class="w-full sm:w-auto py-3 px-8 rounded-xl font-semibold bg-green-600 text-white hover:bg-green-700 transition-all transform hover:scale-105 shadow-sm hover:shadow-lg">Save Changes</button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Change Password Tab -->
                        <div class="tab-pane hidden" id="password">
                            <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg shadow-gray-200/50 border border-gray-100">
                                <h2 class="text-xl font-bold text-gray-800 mb-6">Change Your Password</h2>
                                <form method="POST">
                                    {% csrf_token %}
                                    <div class="space-y-6">
                                       <div>
                                            <label for="id_old_password" class="block text-sm font-semibold text-gray-700 mb-2">Current Password</label>
                                            <input type="password" name="old_password" id="id_old_password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all" required>
                                       </div>
                                       <div>
                                            <label for="id_new_password1" class="block text-sm font-semibold text-gray-700 mb-2">New Password</label>
                                            <input type="password" name="new_password1" id="id_new_password1" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all" required>
                                       </div>
                                       <div>
                                            <label for="id_new_password2" class="block text-sm font-semibold text-gray-700 mb-2">Confirm New Password</label>
                                            <input type="password" name="new_password2" id="id_new_password2" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all" required>
                                       </div>
                                    </div>
                                    <div class="mt-8">
                                        <button type="submit" name="change_password" class="w-full sm:w-auto py-3 px-8 rounded-xl font-semibold bg-green-600 text-white hover:bg-green-700 transition-all transform hover:scale-105 shadow-sm hover:shadow-lg">Update Password</button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Danger Zone Tab -->
                        <div class="tab-pane hidden" id="danger">
                            <div class="border-4 border-red-200 bg-red-50 p-6 sm:p-8 rounded-2xl">
                                <h2 class="text-xl font-bold text-red-800 mb-4">Danger Zone</h2>
                                <p class="text-red-700 mb-6">Once you delete your account, there is no going back. Please be certain.</p>
                                <button id="delete-account-btn" class="w-full sm:w-auto py-3 px-8 rounded-xl font-semibold bg-red-600 text-white hover:bg-red-700 transition-colors">Delete My Account</button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="fixed inset-0 w-full h-full bg-black/60 z-50 hidden items-center justify-center p-4">
        <div class="bg-white p-8 rounded-2xl text-center max-w-sm w-full shadow-xl" id="delete-modal-content">
            <h3 class="text-2xl font-bold mb-2">Are you sure?</h3>
            <p class="text-gray-500 mb-6">This action is permanent and cannot be undone. All your data will be erased.</p>
            <div class="flex gap-4">
                <button id="modal-close-btn" class="flex-1 text-center py-3 px-4 rounded-xl font-semibold border border-gray-300 text-gray-700 hover:bg-gray-100 transition-colors">Cancel</button>
                <form method="POST" action="{% url 'users:delete_account' %}" class="flex-1">
                    {% csrf_token %}
                    <button type="submit" class="w-full text-center py-3 px-4 rounded-xl font-semibold bg-red-500 text-white hover:bg-red-600 transition-colors">Yes, Delete It</button>
                </form>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Mobile menu toggle
            const menuToggle = document.getElementById('menu-toggle');
            const sidebar = document.getElementById('sidebar');
            if (menuToggle && sidebar) {
                menuToggle.addEventListener('click', () => {
                    sidebar.classList.toggle('-translate-x-full');
                });
            }

            // Avatar preview
            const avatarInput = document.getElementById('id_profile_picture');
            const avatarPreview = document.getElementById('avatar-preview');
            if(avatarInput && avatarPreview) {
                avatarInput.addEventListener('change', function(event) {
                    if (event.target.files && event.target.files[0]) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            avatarPreview.src = e.target.result;
                        }
                        reader.readAsDataURL(event.target.files[0]);
                    }
                });
            }

            // Tab functionality
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabPanes = document.querySelectorAll('.tab-pane');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    tabButtons.forEach(btn => btn.classList.remove('tab-active'));
                    tabPanes.forEach(pane => pane.classList.add('hidden'));

                    button.classList.add('tab-active');
                    const tabId = button.dataset.tab;
                    document.getElementById(tabId).classList.remove('hidden');
                });
            });

            // Delete modal functionality
            const deleteModal = document.getElementById('delete-modal');
            const deleteBtn = document.getElementById('delete-account-btn');
            const closeBtn = document.getElementById('modal-close-btn');

            if(deleteModal && deleteBtn && closeBtn) {
                deleteBtn.addEventListener('click', () => {
                    deleteModal.classList.remove('hidden');
                    deleteModal.classList.add('flex');
                });
                 closeBtn.addEventListener('click', () => {
                    deleteModal.classList.add('hidden');
                    deleteModal.classList.remove('flex');
                });
                 window.addEventListener('click', (event) => {
                    if (event.target === deleteModal) {
                        deleteModal.classList.add('hidden');
                        deleteModal.classList.remove('flex');
                    }
                });
            }

            // This script applies Tailwind classes to all form fields
            const formFields = document.querySelectorAll(
                'form input[type="text"], form input[type="email"], form textarea'
            );
            const fieldClasses = [
                'w-full', 'p-3', 'border', 'border-gray-300', 'rounded-lg', 
                'focus:ring-2', 'focus:ring-green-500', 'focus:border-green-500', 
                'transition-all', 'text-base', 'bg-slate-50'
            ];
            formFields.forEach(field => {
                field.classList.add(...fieldClasses);
            });
        });
    </script>

</body>
</html>

