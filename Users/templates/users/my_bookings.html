<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Bookings - Turfie</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #00C853; --primary-dark: #009624; --dark: #212121;
            --gray: #757575; --light-gray: #f5f7fa; --white: #FFFFFF;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12); --shadow-md: 0 4px 6px rgba(0,0,0,0.16);
            --transition: all 0.3s ease;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--light-gray); color: var(--dark); }
        .header { background: var(--white); box-shadow: var(--shadow-sm); padding: 15px 0; position: sticky; top: 0; z-index: 1000; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .nav { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 24px; font-weight: 700; color: var(--primary); text-decoration: none; display: flex; align-items: center; }
        .logo i { margin-right: 10px; }
        .back-link { font-weight: 600; color: var(--dark); text-decoration: none; display: flex; align-items: center; gap: 8px; }
        .main-content { padding: 40px 0; }
        .page-header { margin-bottom: 30px; }
        .page-title { font-size: 32px; font-weight: 700; }
        .section-title { font-size: 24px; font-weight: 600; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #ddd; }
        .bookings-list { display: flex; flex-direction: column; gap: 20px; }
        .booking-card { background: var(--white); border-radius: 12px; box-shadow: var(--shadow-sm); display: flex; overflow: hidden; transition: var(--transition); }
        .booking-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-md); }
        .booking-image { width: 220px; object-fit: cover; flex-shrink: 0; }
        .booking-content { padding: 20px; flex: 1; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .booking-details { flex-basis: 50%; min-width: 300px; }
        .booking-details h3 { font-size: 20px; margin-bottom: 5px; }
        .booking-details p { color: var(--gray); margin-bottom: 15px; }
        .booking-time { display: flex; align-items: center; gap: 8px; font-weight: 500; }
        .booking-actions { text-align: right; flex-basis: 200px; display: flex; flex-direction: column; align-items: flex-end; justify-content: center; }
        .booking-amount { font-size: 22px; font-weight: 700; margin-bottom: 10px; }
        .booking-status { padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 700; text-transform: capitalize; }
        .status-confirmed { background: rgba(76,175,80,0.1); color: #2E7D32; }
        .status-pending { background: rgba(255,152,0,0.1); color: #F57C00; }
        .status-cancelled { background: rgba(244,67,54,0.1); color: var(--danger); }
        .status-completed { background: rgba(63,81,181,0.1); color: #303F9F; }
        .btn { padding: 8px 16px; border-radius: 6px; font-weight: 600; cursor: pointer; transition: var(--transition); border: 1px solid var(--primary); background: transparent; color: var(--primary); text-decoration: none; display: inline-block; width: 100%; text-align: center; margin-top: 10px; }
        .btn:hover { background: rgba(0,200,83,0.1); }
        .btn-danger { border-color: var(--danger); color: var(--danger); }
        .btn-danger:hover { background: rgba(211,47,47,0.1); }
        .empty-message { text-align: center; padding: 40px; background: var(--white); border-radius: 12px; }
        
        /* Modal Styles */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; display: none; align-items: center; justify-content: center; }
        .modal-content { background: var(--white); padding: 30px; border-radius: 12px; text-align: center; max-width: 400px; }
        .modal-content h3 { font-size: 22px; margin-bottom: 10px; }
        .modal-content p { color: var(--gray); margin-bottom: 25px; }
        .modal-actions { display: flex; gap: 15px; }
        .modal-actions .btn { width: auto; flex: 1; }
    </style>
</head>
<body>
    <header class="header">
        <div class="container nav">
            <a href="{% url 'users:dashboard_player' %}" class="logo"><i class="fas fa-futbol"></i> Turfie</a>
            <a href="{% url 'users:dashboard_player' %}" class="back-link"><i class="fas fa-arrow-left"></i> Back to Dashboard</a>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="page-header"><h1 class="page-title">My Bookings</h1></div>

            <section style="margin-bottom: 40px;">
                <h2 class="section-title">Upcoming Bookings</h2>
                <div class="bookings-list">
                    {% for booking in upcoming_bookings %}
                    <div class="booking-card">
                        <img src="{% if booking.turf.main_image %}{{ booking.turf.main_image.url }}{% else %}https://placehold.co/220x200/E0E0E0/757575?text=No+Image{% endif %}" alt="{{ booking.turf.name }}" class="booking-image">
                        <div class="booking-content">
                            <div class="booking-details">
                                <h3>{{ booking.turf.name }}</h3>
                                <p>{{ booking.turf.city }}, {{ booking.turf.district }}</p>
                                <div class="booking-time">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>{{ booking.start_time|date:"D, d M Y" }} &middot; {{ booking.start_time|time:"g:i A" }} - {{ booking.end_time|time:"g:i A" }}</span>
                                </div>
                            </div>
                            <div class="booking-actions">
                                <div class="booking-amount">₹{{ booking.amount|floatformat:0 }}</div>
                                <div class="booking-status status-{{ booking.status }}">{{ booking.get_status_display }}</div>
                                {% if booking.status != 'cancelled' %}
                                    <button class="btn btn-danger cancel-btn" data-booking-id="{{ booking.id }}">Cancel</button>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="empty-message"><p>You have no upcoming bookings. <a href="#">Find a turf to play!</a></p></div>
                    {% endfor %}
                </div>
            </section>

            <section>
                <h2 class="section-title">Past Bookings</h2>
                <div class="bookings-list">
                    {% for booking in past_bookings %}
                    <div class="booking-card">
                        <img src="{% if booking.turf.main_image %}{{ booking.turf.main_image.url }}{% else %}https://placehold.co/220x200/E0E0E0/757575?text=No+Image{% endif %}" alt="{{ booking.turf.name }}" class="booking-image">
                        <div class="booking-content">
                            <div class="booking-details"><!-- ... details ... --></div>
                            <div class="booking-actions">
                                <div class="booking-amount">₹{{ booking.amount|floatformat:0 }}</div>
                                <div class="booking-status status-{{ booking.status }}">{{ booking.get_status_display }}</div>
                                {% if booking.turf.is_available_for_booking %}
                                    <a href="{% url 'turfs:turf_detail' booking.turf.id %}" class="btn">Book Again</a>
                                {% else %}
                                    <button class="btn" disabled title="This turf is not currently available for booking.">Book Again</button>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="empty-message"><p>You have no past bookings.</p></div>
                    {% endfor %}
                </div>
            </section>
        </div>
    </main>

    <!-- Cancellation Modal -->
    <div id="cancel-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Cancel Booking?</h3>
            <p>Are you sure you want to cancel this booking? This action cannot be undone.</p>
            <div class="modal-actions">
                <button id="modal-close-btn" class="btn">Keep Booking</button>
                <button id="modal-confirm-btn" class="btn btn-danger">Yes, Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Hidden forms for cancellation -->
    {% for booking in upcoming_bookings %}
        <form id="cancel-form-{{ booking.id }}" action="{% url 'turfs:manage_booking' booking.id %}" method="POST" style="display: none;">
            {% csrf_token %}
            <input type="hidden" name="action" value="cancel">
        </form>
    {% endfor %}

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const cancelModal = document.getElementById('cancel-modal');
            const confirmBtn = document.getElementById('modal-confirm-btn');
            const closeBtn = document.getElementById('modal-close-btn');
            let bookingIdToCancel = null;

            document.querySelectorAll('.cancel-btn').forEach(button => {
                button.addEventListener('click', function() {
                    bookingIdToCancel = this.dataset.bookingId;
                    cancelModal.style.display = 'flex';
                });
            });

            closeBtn.addEventListener('click', () => {
                cancelModal.style.display = 'none';
            });

            confirmBtn.addEventListener('click', () => {
                if (bookingIdToCancel) {
                    const form = document.getElementById(`cancel-form-${bookingIdToCancel}`);
                    if (form) {
                        form.submit();
                    }
                }
            });

            window.addEventListener('click', (event) => {
                if (event.target === cancelModal) {
                    cancelModal.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
